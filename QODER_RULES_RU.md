# Правила QODER

Этот документ содержит правила и рекомендации для Qoder при работе с этой кодовой базой.

## Содержание

1. [Общие правила разработки](#общие-правила-разработки)
2. [Правила разработки бэкенда](#правила-разработки-бэкенда)
3. [Правила разработки фронтенда](#правила-разработки-фронтенда)
4. [Правила работы с базами данных](#правила-работы-с-базами-данных)
5. [Правила тестирования](#правила-тестирования)
6. [Правила документирования](#правила-документирования)
7. [Правила код-ревью](#правила-код-ревью)
8. [Правила производительности](#правила-производительности)
9. [Правила безопасности](#правила-безопасности)
10. [Правила структуры файлов](#правила-структуры-файлов)
11. [Дополнительные рекомендации](#дополнительные-рекомендации)

## 1. Общие правила разработки

### 1.1. Соглашения о коде

- Используйте согласованные соглашения об именовании для переменных, функций и классов.
- Следуйте установленным шаблонам кодирования и передовым практикам.
- Пишите понятный, краткий и поддерживаемый код.

### 1.2. Управление версиями

- Используйте feature-ветки для новой разработки.
- Пишите понятные и описательные сообщения коммитов.
- Отправляйте pull request'ы для код-ревью перед слиянием.

### 1.3. Код-ревью

- Проверяйте код на соответствие стандартам кодирования.
- Предоставляйте конструктивную обратную связь и предложения по улучшению.
- Убедитесь, что код соответствует требованиям качества и производительности.

## 2. Правила разработки бэкенда

### 2.1. Реализация контроллеров

- Явно перечисляйте поля во время операций вставки и обновления.
- Пропускайте реляционные поля в явном перечислении полей и обрабатывайте их отдельно, используя синтаксис Prisma `connect`.
- Используйте условное присваивание полей для необязательных полей.

### 2.2. Использование DTO

- Расширенные DTO не должны содержать поля, которые автоматически управляются системой.
- Используйте базовые DTO для полей, которые должны быть явно предоставлены пользователем.

### 2.3. Схема Prisma и миграции

- Используйте описательные имена для полей отношений.
- Добавляйте индексы к часто запрашиваемым полям.
- Определяйте уникальные ограничения для полей, которые должны быть уникальными.
- Устанавливайте соответствующие значения по умолчанию для полей.
- Внимательно рассматривайте, должны ли поля быть nullable.

### 2.4. Обработка отношений

- Определяйте двунаправленные отношения с надлежащими соглашениями об именовании.
- Используйте конкретные имена полей для отношений, чтобы избежать неоднозначности.
- Внимательно рассматривайте каскадные операции для операций удаления.

## 3. Правила разработки фронтенда

### 3.1. Реализация компонентов сетки

- Компоненты сетки должны иметь входные свойства для реляционных полей.
- Используйте реляционные поля в качестве фильтров в методе `loadMany`.
- Передавайте реляционные поля компонентам формы в методе `showCreateOrUpdateModal`.
- Компоненты сетки должны поддерживать режим просмотра с отображением пользовательского заголовка вместо кнопок действий.

### 3.2. Реализация компонентов формы

- Компоненты формы должны принимать входные данные реляционных полей от компонентов сетки.
- Включайте реляционные поля в объект данных при создании новых записей.

### 3.3. Обработка полей даты

- Обрабатывайте поля `createdAt` и `updatedAt` с корректировкой смещения часового пояса.
- Обрабатывайте другие поля дат как обычные даты без корректировки часового пояса.

## 4. Правила работы с базами данных

### 4.1. Проектирование баз данных

- Проектируйте базы данных с учетом производительности и масштабируемости.
- Используйте соответствующие типы данных и стратегии индексации.
- Обеспечивайте целостность и согласованность данных.

### 4.2. Миграция данных

- Включайте шаги миграции данных при изменении структур или типов данных.
- Тестируйте миграции в среде разработки перед применением в производстве.
- Имейте планы отката для критических миграций.

## 5. Правила тестирования

### 5.1. Модульное тестирование

- Пишите модульные тесты для сервисов и компонентов.
- Правильно мокайте зависимости в тестах.
- Тестируйте граничные случаи и условия ошибок.

### 5.2. Интеграционное тестирование

- Пишите интеграционные тесты для сложных рабочих процессов и взаимодействий.
- Убедитесь, что тесты охватывают все возможные сценарии.

## 6. Правила документирования

### 6.1. Комментарии в коде

- Добавляйте встроенные комментарии для сложной логики.
- Документируйте публичные функции с описанием параметров и возвращаемых значений.
- Документируйте интерфейсы и их свойства.

### 6.2. Файлы README

- Поддерживайте актуальность файлов README для проектов и библиотек.
- Предоставляйте четкие инструкции по установке и настройке.
- Включайте примеры использования для ключевых функций.

## 7. Правила код-ревью

### 7.1. Процесс код-ревью

- Проверяйте код на соответствие стандартам кодирования.
- Предоставляйте конструктивную обратную связь и предложения по улучшению.
- Убедитесь, что код соответствует требованиям качества и производительности.

### 7.2. Парное программирование

- Поощряйте парное программирование для сложных функций.
- Содействуйте обмену знаниями и сотрудничеству.

## 8. Правила производительности

### 8.1. Загрузка данных

- Реализуйте надлежащую пагинацию для больших наборов данных.
- Используйте дебаунсинг для поисковых полей ввода для уменьшения вызовов API.
- Реализуйте соответствующие стратегии кэширования.

### 8.2. Управление памятью

- Всегда отписывайтесь от observables, чтобы предотвратить утечки памяти.
- Правильно обрабатывайте события жизненного цикла компонентов.

## 9. Правила безопасности

### 9.1. Аутентификация и авторизация

- Реализуйте надлежащий контроль доступа на основе ролей.
- Обеспечьте надлежащую изоляцию арендаторов в многотенантных приложениях.
- Фильтруйте данные на основе ролей пользователей и ID арендаторов.

### 9.2. Санитизация ввода

- Проверяйте все входные данные как на фронтенде, так и на бэкенде.
- Используйте параметризованные запросы и функции ORM для предотвращения SQL-инъекций.

## 10. Правила структуры файлов

### 10.1. Именование файлов

- Используйте согласованные соглашения об именовании для файлов и каталогов.
- Используйте описательные имена для файлов и каталогов.

### 10.2. Организация файлов

- Организуйте файлы в логическую структуру, отражающую архитектуру приложения.
- Разделяйте различные аспекты по разным файлам и каталогам.

## 11. Дополнительные рекомендации

### 11.1. Правила анализа кода

Для получения полного набора шаблонов разработки, извлеченных непосредственно из кодовой базы, обратитесь к [QODER_RULES_BY_CODE.md](./QODER_RULES_BY_CODE.md). Этот файл содержит правила, полученные из фактических реализаций в проекте, и должен использоваться в качестве справочника для поддержания согласованности с существующими шаблонами.

### 11.2. Согласованность технологического стека

- Поддерживайте согласованность с существующим технологическим стеком
- Следуйте установленным шаблонам для разработки новых функций
- Обеспечьте совместимость с существующими модулями и сервисами

### 11.3. Обработка ошибок

- Реализуйте graceful degradation для некритических функций.
- Предоставляйте соответствующую обратную связь пользователям при возникновении ошибок.

### 11.4. Повторное использование кода

- Проектируйте компоненты так, чтобы они были пригодны для повторного использования, где это уместно.
- Абстрагируйте общую функциональность в сервисы.

### 11.5. Соображения производительности

- Реализуйте ленивую загрузку для модулей и компонентов, когда это уместно.
